# 第四节 使用 INI 指令

有些时候我们可能希望一些初始化的配置项从 `php.ini` 里读取的，所以我们这里学习下添加 INI 指令。
添加的方式有两种：一种是直接添加，另一种是配合全局变量。

## 准备

我们准备一个简单地扩展 demo，这个步骤不再重复说明，请参考前一节

    [c]
    [root@localhost ext]# cat ini.proto
    string get_demo_init_value()
    [root@localhost ext]# ./ext_skel --extname=tipi_ini_demo --proto=ini.proto

## 使用 PHP_INI_ENTRY 添加

### 声明

打开`tipi_ini_demo.c`的`PHP_INI_BEGIN`宏和`PHP_INI_END`宏的注释。这里仅演示一个配置项

    [c]
    PHP_INI_BEGIN()
        PHP_INI_ENTRY("tipi_ini_demo.global_value", "42", PHP_INI_ALL, NULL)
    PHP_INI_END()

### 注册

    [c]
    PHP_MINIT_FUNCTION(tipi_ini_demo)
    {
       REGISTER_INI_ENTRIES();
       return SUCCESS;
    }

### 注销

    [c]
    PHP_MSHUTDOWN_FUNCTION(tipi_ini_demo)
    {
       UNREGISTER_INI_ENTRIES();
       return SUCCESS;
    }

### 使用

    [c]
    PHP_FUNCTION(get_demo_init_value)
    {
       RETURN_LONG(INI_INT("tipi_ini_demo.global_value"));
    }

### 编译测试

编译的步骤不再重复说明，请参考本章开头的方式

    [shell]
    [root@localhost tipi_ini_demo]# php7 -d"extension=tipi_ini_demo.so" -r "var_dump(get_demo_init_value());"
    int(42)

执行结果为42。然后编辑 `php.ini` 

    [shell]
    vim /usr/local/php7/etc/php.ini
    
添加指令

    [shell]
    tipi_ini_demo.global_value = 100
    
重新运行，结果则是 100 了，说明 `php.ini` 指令配置成功。

